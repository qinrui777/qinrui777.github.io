<!DOCTYPE html>


  <html lang="en">
    

    <head>
      <meta charset="utf-8" />
        
      <meta
        name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1"
      />
      <title> Hexo</title>
  <meta name="generator" content="hexo-theme-ayer">
      
      <link rel="shortcut icon" href="/palm-tree.ico" />
       <link rel="stylesheet" href="/dist/main.css">
      <link
        rel="stylesheet"
        href="https://cdn.jsdelivr.net/gh/Shen-Yu/cdn/css/remixicon.min.css"
      />
      <link rel="stylesheet" href="/css/custom.css"> 
      <script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script>
       
 

      <!-- mermaid -->
      
    </head>
  </html>
</html>


<body>
  <div id="app">
    
      
    <main class="content on">
      
<section class="cover">
    
  <div class="cover-frame">
    <div class="bg-box">
      <img src="/images/cover2.jpg" alt="image frame" />
    </div>
    <div class="cover-inner text-center text-white">
      <h1><a href="/">Hexo</a></h1>
      <div id="subtitle-box">
        
        <span id="subtitle"></span>
        
      </div>
      <div>
        
      </div>
    </div>
  </div>
  <div class="cover-learn-more">
    <a href="javascript:void(0)" class="anchor"><i class="ri-arrow-down-line"></i></a>
  </div>
</section>



<script src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11/lib/typed.min.js"></script>


<!-- Subtitle -->

  <script>
    try {
      var typed = new Typed("#subtitle", {
        strings: ['一笑皆春', '', ''],
        startDelay: 0,
        typeSpeed: 200,
        loop: true,
        backSpeed: 100,
        showCursor: true
      });
    } catch (err) {
      console.log(err)
    }
  </script>
  
<div id="main">
  <section class="outer">
  
  
  <article class="articles">
    
    
    
    
    <article
  id="post-Spike-回顾"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/11/19/Spike-回顾/"
    >Spike 回顾</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2021/11/19/Spike-回顾/" class="article-date">
  <time datetime="2021-11-19T06:53:26.000Z" itemprop="datePublished">2021-11-19</time>
</a>  
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h3 id="起因"><a href="#起因" class="headerlink" title="起因"></a>起因</h3><p>在当前的项目已经快一年了，当初团队成员的一句要求，给大家换来了定期的Innovation Week。在这一周里可以不用专注于当前手上乱七八糟的各种问题和令人有喜有忧的新功能，而是专注于另一项自己感兴趣的小工具、特定使用场景，也可以是某个疑难杂症。而在一周结束之后，团队成员汇聚一堂做简单的成果分享，然后结束这个过程。所以我们的做法本质上还不是Spike，但相互之间却有很多值得借鉴的地方。</p>
<p>这样做的好处显而易见，给成员留足了时间去学习新工具、新技术，也可以看作是一种变向的自我学习周期。当然，从管理者角度出发，无疑燃烧了经费成本，但却不一定对项目有明显的效果。偶然之后才意思到这个Spike的过程是个专业术语，前人早就有了较好的模式和实践流程，而自身尽然摸爬滚打野路子出家弄了半年。好在回过头来看，并没有走 太多的错路，弄出一些奇怪的实践。但却是时候回顾这个Spike原本的样子，然后理解它，免得日后张冠李戴。</p>
<h4 id="什么是Spike"><a href="#什么是Spike" class="headerlink" title="什么是Spike?"></a>什么是Spike?</h4><p>Spike 常见的英文翻译是“长钉或者刺穿”，作为名词，也可以作为动词。 Spike 一词来源于攀岩中的比喻， 在攀岩过程中，攀岩的人在没有办法落脚的情况下选择使用岩钉作为锚点来保护自己，从而避免跌倒或协助后续的辅助攀登。其次，这个词来源于 Extreme Programming (XP)</p>
<p>而这个词在软件开发中来源于 Extreme Programming </p>
<blockquote>
<p>“A spike solution is a very simple program to explore potential solutions.”</p>
</blockquote>
<p>来到敏捷开发过程中，由于敏捷中强调不确定性、拥抱变化，那么在日常开发过程中，也会遇到一些任务。比如技术方案或者未知的探索，于是敏捷中的 Spike 是一项技术调研。通过简答的调查、设计、demo 来快速验证，这样说起来和 POC(prove of concept) 是不是很像。</p>
<p>特殊的 “Spike”：起源于客户一次偶然提出的建议，希望在完成项目要求的任务同时，能够有一些自由一些的时间去完成自己感兴趣的技术主题的研究，来提高自身的能力。所以我们把那一小段时间也看成是 Innovation Week，用于去探索新的、未曾使用过的技术。但我们一直用 “Spike” 来描述这样的事情，似乎也解释得通。</p>
<p>较之于 Extreme Programming（极限编程）中的解释最大的不同，我个人认为是对开发人员的自由度。毕竟前者是项目中存在的不确定性和问题亟待解决，而后者 让开发人员有较大的自由度去选择一个新的技术主题进行任意的探索。</p>
<h4 id="为什么要做Spike"><a href="#为什么要做Spike" class="headerlink" title="为什么要做Spike?"></a>为什么要做Spike?</h4><p>对于极限编程中的 Spike，虽然 Spike 本身没有完成相应的功能，没有交付业务功能，但是为后续可能遇到的难题扫除了障碍、降低了不确定性，从而保障最终业务价值的交付、减少延期的风险，好处已经人人皆知了。</p>
<p>而对亲历的项目中的 “Spike” 而言，从个人角度而非项目的角度有以下几个优点：</p>
<ul>
<li>激励个人创新，大胆尝试</li>
<li>学习新的技术栈，提升个人能力，拓宽视野</li>
<li>作为紧张的迭代中的一个缓冲期，得以缓和情绪和整理心情</li>
</ul>
<h4 id="Spike与故事卡的区别？"><a href="#Spike与故事卡的区别？" class="headerlink" title="Spike与故事卡的区别？"></a>Spike与故事卡的区别？</h4><p>Spike 在某种程度上可以是一种特殊的user story，区别在于用户故事交付产品业务功能，需求目标相对明确；二spike本身不交付产品功能，问题明确，但在实际做的过程中可能有很多的不确定性。</p>
<h4 id="如何来做Spike"><a href="#如何来做Spike" class="headerlink" title="如何来做Spike?"></a>如何来做Spike?</h4><p>已经“巧立名目”了，那么接下来就是大展身手，做出点小小的成果的时候了。</p>
<h5 id="第一步-选定主题"><a href="#第一步-选定主题" class="headerlink" title="第一步: 选定主题"></a>第一步: 选定主题</h5><p>  可以是你已经了解的技术栈，但是没有深入研究的某一部分；</p>
<p>  也可以是你从其他项目偶然听到的新名词，但是你从来没有实际上手接触过；</p>
<p>  另外，如果你想“讨好”项目，那么从技术债中选择一块硬骨头也是一个不错的选择；</p>
<p>  亦或是未雨绸缪，率先走入即将被项目采用的新技术中去“探探路”，为项目减少一些隐藏的风险；</p>
<p>  如果实在没有头绪，不妨翻阅往期的技术雷达（都是大佬们已经帮你筛选过了的技术条目，又新又好）；</p>
<p>  或者交给网络，用搜索引擎搜一下类似的关键字 Top 10 New Technology Trends for 2023。</p>
<h5 id="第二步-初步了解"><a href="#第二步-初步了解" class="headerlink" title="第二步: 初步了解"></a>第二步: 初步了解</h5><p>万般开头难，进入这一步也是真正的开始研究了。既然手中掌握着最关键的线索了，那么以下几个搜索资料的渠道不妨试试：</p>
<ul>
<li>官方网站 （历史起源、安装/使用方法、功能模块、Roadmap 等等</li>
<li>Github 源码 （查看它的开发语言进一步了解特性，Star数量，Issue数量和常见问题</li>
<li>论坛 （避坑指南，踩坑大全，也许有一些最佳实践）</li>
<li>Youtube 上的大会视频 （看看视频，听听作者或布道师的理解）</li>
<li>…</li>
</ul>
<h5 id="第三步：罗列大纲"><a href="#第三步：罗列大纲" class="headerlink" title="第三步：罗列大纲"></a>第三步：罗列大纲</h5><p>为了避免漫无目的，在进行了初步的之后相信你应该大概知道自己想要做些什么，可以在有限的时间内完成哪些任务了。那么把他们按优先级罗列出来或许能时刻提醒自己，也是帮助进一步缩小范围。用一些简要的关键字描述即可，毕竟咱们可是“新手”。</p>
<h5 id="第四步：总结归纳"><a href="#第四步：总结归纳" class="headerlink" title="第四步：总结归纳"></a>第四步：总结归纳</h5><p>完成了大部分的任务也别忘了留一点时间，做一下简单的回顾，反思在哪些地方浪费了时间以及踩过的坑，某个问题是否值得关注；或者对比自己用过的同类型工具做一个快速的优劣势分析。</p>
<h5 id="第五步：展示成果"><a href="#第五步：展示成果" class="headerlink" title="第五步：展示成果"></a>第五步：展示成果</h5><p>以上如果通通做完了，那么不妨把你的成果和发现给团队成员展示一下，也可以适当邀请其他小组对该主题感兴趣的同学。当然如果能够邀请到客户或者 PO 莅临效果更加，别忘了做一个稍微美观一些的 PPT 。或许有一些意想不到的问题出现，也会有经验丰富的同学给予一些好的建议，帮助我们下次考虑得更周到，做得更好。</p>
<h3 id="回顾一下"><a href="#回顾一下" class="headerlink" title="回顾一下"></a>回顾一下</h3><p>在适当的时间开启 Innovation Week，并鼓励团队成员大胆自由地尝试新技术栈和工具，起初或许非常的新鲜。但这一过程也不是总是一帆风顺的，可能灵感枯竭找不到合适的主题，可能忙活了3-5天也没能产出一个好的成功的Demo，又或者辛苦做出来的成果不完全被他人认可…  </p>
<p><img src="/images/spike_reference_img.png" alt="spike"></p>
<hr>
<p>Reference:</p>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Spike_(software_development)" target="_blank" rel="noopener">https://en.wikipedia.org/wiki/Spike_(software_development)</a></li>
<li><a href="http://agiledictionary.com/209/spike/" target="_blank" rel="noopener">http://agiledictionary.com/209/spike/</a></li>
<li><a href="https://www.leadingagile.com/2016/09/whats-an-agile-spike-who-should-enter-it-how-to-word-it/" target="_blank" rel="noopener">https://www.leadingagile.com/2016/09/whats-an-agile-spike-who-should-enter-it-how-to-word-it/</a></li>
</ul>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Agile/">Agile</a></li></ul>

    </footer>
  </div>

    
 
    
</article>

    
    <article
  id="post-Helm-使用小结"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/11/15/Helm-使用小结/"
    >Helm 使用小结</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2021/11/15/Helm-使用小结/" class="article-date">
  <time datetime="2021-11-15T07:06:58.000Z" itemprop="datePublished">2021-11-15</time>
</a>  
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h3 id="1-What-is-Helm"><a href="#1-What-is-Helm" class="headerlink" title="1.What is Helm"></a>1.What is Helm</h3><p>Helm is a tool for managing Kubernetes packages called charts.</p>
<p>Three important concepts</p>
<ul>
<li>The <strong>Chart</strong> is a bundle of information necessary to create an instance of a Kubernetes application.</li>
</ul>
<ul>
<li>A <strong>Release</strong> is a running instance of a chart, combined with a specific config.</li>
<li><strong>Repository</strong> – Publicly available charts.</li>
</ul>
<p>Helm v2 和 v3的架构如下，主要区别是 Tiller。</p>
<p><img src="https://cdnjson.com/images/2021/06/02/helm_arch.png" alt="helm_arch.png"></p>
<p> 当然 helm v2与 v3  在命令上也有一些区别，不过老的命令（例如fetch）亲自试验过还能用</p>
<table>
<thead>
<tr>
<th style="text-align:left">Command</th>
<th style="text-align:left">Helm2</th>
<th style="text-align:left">Helm3</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Initialize Helm client/server</td>
<td style="text-align:left">init</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">Download a chart to your local directory</td>
<td style="text-align:left">fetch</td>
<td style="text-align:left">pull</td>
</tr>
<tr>
<td style="text-align:left">Given a release name, delete the release from Kubernetes</td>
<td style="text-align:left">delete</td>
<td style="text-align:left">uninstall</td>
</tr>
<tr>
<td style="text-align:left">Helm client environment information</td>
<td style="text-align:left"></td>
<td style="text-align:left">env</td>
</tr>
<tr>
<td style="text-align:left">Displays the location of HELM_HOME</td>
<td style="text-align:left">home</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">Inspect a chart</td>
<td style="text-align:left">inspect</td>
<td style="text-align:left">show</td>
</tr>
<tr>
<td style="text-align:left">Uninstalls Tiller from a cluster</td>
<td style="text-align:left">reset</td>
</tr>
</tbody>
</table>
<p>Hub - &gt; repo -&gt; Chart -&gt; App， 从左到右均是一对多的关系。</p>
<h3 id="2-一些常用的命令"><a href="#2-一些常用的命令" class="headerlink" title="2.一些常用的命令"></a>2.一些常用的命令</h3><p><strong>关于repo</strong></p>
<p>list repos</p>
<p><code>helm repo list</code></p>
<p>add a repo</p>
<p><code>helm repo add aliyun https://kubernetes.oss-cn-hangzhou.aliyuncs.com/charts</code></p>
<p>remove a repo, then check again</p>
<p><code>helm repo remove aliyun &amp;&amp; helm repo list</code></p>
<p>helm search hub – Searches through the <a href="https://artifacthub.io/packages/search?kind=0" target="_blank" rel="noopener">Artifact Hub</a> from dozens of repositories.</p>
<p><code>helm search hub wordpress</code></p>
<p>helm search repo – Searches through repositories added in the local helm client using helm repo add.</p>
<p><code>helm search repo wordpress</code></p>
<blockquote>
<p>When you find a suitable chart, install it using <code>helm install</code></p>
</blockquote>
<p>一个repo里可以有多个chart，</p>
<p><strong>关于chart</strong></p>
<p>download a chart to local</p>
<p><code>helm pull csi-secrets-store-provider-azure/csi-secrets-store-provider-azure --version 0.0.19 --untar</code></p>
<p>list all the charts in a repository</p>
<p><code>helm search repo bitnami</code></p>
<p><code>helm repo add stable https://charts.helm.sh/stable</code></p>
<p><code>helm show readme stable/ghost</code></p>
<p><code>helm install --values=ghost-values.yaml stable/ghost --generate-name</code></p>
<p><code>helm ls</code></p>
<p><code>helm delete ghost-1622450894</code></p>
<h4 id="What-else"><a href="#What-else" class="headerlink" title="What else"></a>What else</h4><p><code>helm upgrade --values=ghost-values.yaml ghost-1576075187 stable/ghost</code></p>
<p>rollback the app to a specific version</p>
<p><code>helm rollback ghost-1576075187 1</code></p>
<p><code>helm uninstall ghost-1576075187</code></p>
<p>check all resources which is deployed with helm </p>
<p><code>helm get manifest datadog -n datadog</code></p>
<hr>
<p>Reference:</p>
<ul>
<li><a href="https://dev.to/ridaehamdani/some-changes-between-helm-v2-and-helm-v3-that-you-should-know-32ga" target="_blank" rel="noopener">https://dev.to/ridaehamdani/some-changes-between-helm-v2-and-helm-v3-that-you-should-know-32ga</a></li>
</ul>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Helm/">Helm</a></li></ul>

    </footer>
  </div>

    
 
    
</article>

    
    <article
  id="post-Clean-up-Azure-Container-Registry"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/11/05/Clean-up-Azure-Container-Registry/"
    >Clean up Azure Container Registry</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2021/11/05/Clean-up-Azure-Container-Registry/" class="article-date">
  <time datetime="2021-11-05T03:04:19.000Z" itemprop="datePublished">2021-11-05</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/Docker/">Docker</a>
  </div>
 
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h3 id="起因"><a href="#起因" class="headerlink" title="起因"></a>起因</h3><p>打开项目上用了2-3年的Azure Container Registry，就像打开了一个尘封多年的仓库一般。使用者不停的往仓库里堆放物品，但从来不整理、打扫。仓库的容积足够大，不考虑成本的话，都不是问题。但本着“清道夫”的理念，本着清楚潜在问题的出发点（其实是不想后面打开仓库的人也口出“狂言”，而来责怪前面维护的人。）</p>
<h3 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h3><p>在个人电脑上，下载镜像过多且长期不删除也会面临磁盘不足的风险。或多或少都适用过类似 <code>docker image rm</code>的命令，但一个一个的清理难免麻烦耗时。这时候就需要一个一键搞定的命令，例如<code>docker system prune</code>。</p>
<p>对于Azure Container Registry 这样一个成熟的产品服务，已经不建议个人去造轮子、写脚本了。搜索一番之后找到了一篇不错的<a href="https://zimmergren.net/purging-container-images-from-azure-container-registry/" target="_blank" rel="noopener">文章</a>，里面提到了两个具体的方法。</p>
<ul>
<li>1.Set a retention policy for untagged manifests (<a href="https://docs.microsoft.com/en-us/azure/container-registry/container-registry-retention-policy?WT.mc_id=AZ-MVP-4021705" target="_blank" rel="noopener">Microsoft Docs</a>)</li>
<li>2.Automatically purge images from an Azure Container Registry (<a href="https://docs.microsoft.com/en-us/azure/container-registry/container-registry-auto-purge" target="_blank" rel="noopener">Microsoft Docs</a>)</li>
</ul>
<p>具体的使用当然还是参照azure官方的文档为宜，毕竟具体实践因情况而异。</p>
<p>对于，需要注意一点，该policy并不能立刻对现有的镜像生效，原文描述如下：</p>
<blockquote>
<p>! Important</p>
<p>The retention policy applies only to untagged manifests with timestamps after the policy is enabled. Untagged manifests in the registry with earlier timestamps aren’t subject to the policy. For other options to delete image data, see examples in Delete container images in Azure Container Registry.</p>
</blockquote>
<p>运行了一些命令：</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 删除2021-04-01 之前的镜像, 有dry-run参数也可以提前测试一下</span></span><br><span class="line">az acr repository show-manifests --name &lt;YourACRName&gt; --repository demo-web-app \</span><br><span class="line">    --orderby time_asc --query <span class="string">"[?timestamp &lt; '2021-04-01'].digest"</span> -o tsv \</span><br><span class="line">    | xargs -I% az acr repository delete --name &lt;YourACRName&gt; --image demo-web-app@% --yes</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 设置定时任务，以后就会自动按照时间来删除</span></span><br><span class="line">PURGE_CMD=<span class="string">"acr purge --filter 'service-one:.*' --ago 180d"</span></span><br><span class="line"></span><br><span class="line">az acr task create --name purgeAppOneImage  \</span><br><span class="line">--cmd <span class="string">"<span class="variable">$PURGE_CMD</span>"</span> \</span><br><span class="line">--schedule <span class="string">"0 0 * * 2"</span> \</span><br><span class="line">--registry &lt;YourACRName&gt; \</span><br><span class="line">--context /dev/null</span><br></pre></td></tr></table></figure>
<h3 id="意外收获"><a href="#意外收获" class="headerlink" title="意外收获"></a>意外收获</h3><p><strong>tag or digest</strong></p>
<blockquote>
<ul>
<li>The “digest” is a hash of the manifest, introduced in Docker registry v2.</li>
<li>The image ID is a hash of the local image JSON configuration.</li>
</ul>
</blockquote>
<p>在使用 Dockerfile 构建镜像时，base image的使用也涉及这点。提出了一个解决方案 <a href="https://github.com/safe-waters/docker-lock" target="_blank" rel="noopener">docker-lock</a> ，有兴趣的可以使用看看，欢迎交流心得体会～</p>
<blockquote>
<p>Link: <a href="https://developers.redhat.com/blog/2020/03/24/red-hat-universal-base-images-for-docker-users#" target="_blank" rel="noopener">https://developers.redhat.com/blog/2020/03/24/red-hat-universal-base-images-for-docker-users#</a></p>
<p>As you discovered, with docker, tags are mutable. This means that an update to a base image could be pushed that breaks your application code, even if you did not change any of your application code.</p>
<p>You could eliminate this class of bugs by referencing base images by digest rather than by tag. For instance, instead of ruby:2.6.3, use ruby:2.6.3@sha256:2afcffd1a8276d58ef7d2c6d440c83290831abc2d80772a7af720db9aca9cd2e. If you reference by digest, when a new update is pushed to ruby:2.6.3, your application will still use the base image referenced by the digest, and you won’t be affected by the update.</p>
<p>Specifying digests manually is a pain for a variety of reasons. Instead, consider using docker-lock <a href="https://github.com/michaelp..." target="_blank" rel="noopener">https://github.com/michaelp...</a>. docker-lock is a cli-plugin for docker that manages digests in a lockfile (think package-lock.json), so you can still reference base images by tag but receive the benefits of referencing them by digest.</p>
<p>docker-lock ships with 3 commands that take you from development to production:<br>docker lock generate finds base images in your docker and docker-compose files and generates a lockfile containing digests that correspond to their tags.<br>docker lock verify lets you know if there are more recent digests than those last recorded in the lockfile.<br>docker lock rewrite rewrites Dockerfiles and docker-compose files to include digests.</p>
</blockquote>
<p><strong>using-container-image-digests-in-kubernetes-manifests</strong></p>
<blockquote>
<p><a href="https://cloud.google.com/architecture/using-container-image-digests-in-kubernetes-manifests" target="_blank" rel="noopener">https://cloud.google.com/architecture/using-container-image-digests-in-kubernetes-manifests</a>)</p>
</blockquote>
<p> <strong>Tag Count =? Mainfest Count</strong></p>
<blockquote>
<p>详解可见<a href="https://medium.com/@anantvardhan.04/azure-container-registry-acr-cleanup-dfeb8a8bb6a9" target="_blank" rel="noopener">文章</a></p>
</blockquote>
<hr>
<p>Reference:</p>
<ul>
<li><a href="https://zimmergren.net/purging-container-images-from-azure-container-registry/" target="_blank" rel="noopener">https://zimmergren.net/purging-container-images-from-azure-container-registry/</a></li>
<li><a href="https://docs.microsoft.com/en-us/azure/container-registry/container-registry-retention-policy" target="_blank" rel="noopener">https://docs.microsoft.com/en-us/azure/container-registry/container-registry-retention-policy</a></li>
<li><a href="https://docs.microsoft.com/en-us/azure/container-registry/container-registry-auto-purge" target="_blank" rel="noopener">https://docs.microsoft.com/en-us/azure/container-registry/container-registry-auto-purge</a></li>
<li><a href="https://www.ibm.com/docs/en/filenet-p8-platform/5.5.x?topic=deployment-choosing-image-tags-digest" target="_blank" rel="noopener">https://www.ibm.com/docs/en/filenet-p8-platform/5.5.x?topic=deployment-choosing-image-tags-digest</a></li>
<li><a href="https://medium.com/@anantvardhan.04/azure-container-registry-acr-cleanup-dfeb8a8bb6a9" target="_blank" rel="noopener">https://medium.com/@anantvardhan.04/azure-container-registry-acr-cleanup-dfeb8a8bb6a9</a></li>
</ul>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Azure/">Azure</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Docker/">Docker</a></li></ul>

    </footer>
  </div>

    
 
    
</article>

    
    <article
  id="post-Bash-对变量动手脚"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/11/03/Bash-对变量动手脚/"
    >Bash-对变量动手脚</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2021/11/03/Bash-对变量动手脚/" class="article-date">
  <time datetime="2021-11-03T08:31:56.000Z" itemprop="datePublished">2021-11-03</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/Bash/">Bash</a>
  </div>
 
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <p>才疏学浅，最近才注意到变量操作中的一些用法，也由此找到了一个<a href="https://tldp.org/LDP/Bash-Beginners-Guide/html/sect_10_03.html" target="_blank" rel="noopener">好网站</a>。</p>
<p>Operations on variables</p>
<ul>
<li>1.Length of a variable（获取变量长度）</li>
<li>2.Transformations of variables （变换变量）</li>
<li>3.Removing substrings (删除变量中的子串)</li>
<li>4.Replacing parts of variable names (替换变量中的一部分)</li>
</ul>
<p>其中的第2点的写法尤其的惊艳到我，非常的简洁但有效，供上网站上的代码帮助理解一下。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">~ <span class="built_in">echo</span> <span class="variable">$&#123;TEST:-test&#125;</span></span><br><span class="line"><span class="built_in">test</span></span><br><span class="line"></span><br><span class="line">~ <span class="built_in">echo</span> <span class="variable">$TEST</span></span><br><span class="line"></span><br><span class="line">~ <span class="built_in">export</span> TEST=a_string</span><br><span class="line"></span><br><span class="line">~ <span class="built_in">echo</span> <span class="variable">$&#123;TEST:-test&#125;</span></span><br><span class="line">a_string</span><br><span class="line"></span><br><span class="line">~ <span class="built_in">echo</span> <span class="variable">$&#123;TEST2:-$TEST&#125;</span></span><br><span class="line">a_string</span><br></pre></td></tr></table></figure>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Bash/">Bash</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Shell/">Shell</a></li></ul>

    </footer>
  </div>

    
 
    
</article>

    
    <article
  id="post-第二次学习英语"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/10/25/第二次学习英语/"
    >第二次学习英语</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2021/10/25/第二次学习英语/" class="article-date">
  <time datetime="2021-10-25T09:21:48.000Z" itemprop="datePublished">2021-10-25</time>
</a>  
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h3 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h3><p>最近工作中的项目需要与国外的沟通，英语无可厚非的成为彼此能听懂的通用语言。这也是自学生生涯之后难道认识到英语的重要性的时刻之一。听说读写这四门功课一起上阵，起初让人多少有些“畏惧”。但好在有了一个讲英语的环境后，逼迫自己去学习和练习，也有明显的但效果不是很大的提升。</p>
<p>也侧面验证了学生时代英语学习的局限性，就自身而言，起初的确可以开口，但讲的内容可能自己都不知所云。而读写方面，因为可以借助外部工具来辅助，其实效性也没有那么强，留给大脑思考的时间尚且充足，一般没有太大的问题，但懂行的人也可以一眼看出这段英文背后的人的能力如何。(因为一些用法并不简介，或者乱用介词……)</p>
<p>有哪些方面需要思考：</p>
<p>词汇量、发音&amp;口音、不用总要一种表达方式或固定词组、找到自己的兴趣切入点去学习英语（比如通过喜好的歌英歌曲、电影台词等）、固定场景用语（比如我的工作中：站会、Code Review、Retro…）</p>
<h3 id="我的学习资源"><a href="#我的学习资源" class="headerlink" title="我的学习资源"></a>我的学习资源</h3><p><strong>书籍类</strong></p>
<p><strong>podcast类</strong></p>
<p><a href="https://teacherluke.co.uk/" target="_blank" rel="noopener">https://teacherluke.co.uk/</a>  博主口音非常地道，发音清晰</p>
<p><a href="https://english.stackexchange.com/" target="_blank" rel="noopener">https://english.stackexchange.com/</a>   类似<a href="https://stackoverflow.com/的风格、模式" target="_blank" rel="noopener">https://stackoverflow.com/的风格、模式</a></p>
<p><a href="https://www.englishclass101.com/" target="_blank" rel="noopener">https://www.englishclass101.com/</a>  邮箱注册，领取一些免费的课程</p>
<p><a href="https://www.learning-english-onlines.com/5%e5%80%8b%e5%88%9d%e7%b4%9a%e8%8b%b1%e6%96%87%e6%9c%83%e8%a9%b1%e8%aa%b2%e7%a8%8b/" target="_blank" rel="noopener">這5個初級英文會話課程可幫您更有自信地說英語</a></p>
<p><strong>youtube博主</strong></p>
<p>Small talk，开会前经常需要等人，而在这短暂的几分钟里如何双方都没有话题就显得有点儿尴尬。聊一些日常的话题不仅可以帮助增加双方的了解，也可以提升好感，找到一些共同的兴趣爱好。</p>
<p><a href="https://www.youtube.com/watch?v=WGoIoDuf83o" target="_blank" rel="noopener">https://www.youtube.com/watch?v=WGoIoDuf83o</a></p>
<p>超多形容词，歌曲点评，<a href="https://www.youtube.com/watch?v=21lcqYBJQLQ&amp;ab_channel=%E4%B8%8D%E6%98%AF%E6%9F%AF%E6%A1%91%E5%BE%B7" target="_blank" rel="noopener">https://www.youtube.com/watch?v=21lcqYBJQLQ&amp;ab_channel=%E4%B8%8D%E6%98%AF%E6%9F%AF%E6%A1%91%E5%BE%B7</a></p>
<p>一些实用的网站</p>
<ol>
<li><a href="https://www.bbc.co.uk/learningenglish/chinese/features/todays-phrase/" target="_blank" rel="noopener">BBC的今日短语</a>  (主要是一些地道的短语，俚语)</li>
<li><a href="https://www.phrasemix.com/examples" target="_blank" rel="noopener">phrasemix的english lessons</a> (场景用语，用英语讲解固定场景下的对话，实用型)</li>
<li></li>
</ol>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/English-Note/">English-Note</a></li></ul>

    </footer>
  </div>

    
 
    
</article>

    
    <article
  id="post-我的git常用命令"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/03/24/我的git常用命令/"
    >我的git常用命令</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2021/03/24/我的git常用命令/" class="article-date">
  <time datetime="2021-03-24T06:09:49.000Z" itemprop="datePublished">2021-03-24</time>
</a>  
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <p>快速查看最近的commit id,commit message<br><code>git log --oneline</code></p>
<p>回到某个commit版本<br><code>git reset --hard &lt;commit id&gt;</code></p>
<p>查看所有分支，包含本地的和远程的<br><code>git branch -a</code></p>
<p>查看所有tag<br><code>git tag</code></p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Tools/">Tools</a></li></ul>

    </footer>
  </div>

    
 
    
</article>

    
    <article
  id="post-Mongodb-的一些概念"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/03/04/Mongodb-的一些概念/"
    >Mongodb 的一些概念</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2021/03/04/Mongodb-的一些概念/" class="article-date">
  <time datetime="2021-03-04T08:17:38.000Z" itemprop="datePublished">2021-03-04</time>
</a>  
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <p>基本概念，还是对照常用的关系型数据库，这样更容易理解一些</p>
<p><a href="https://imgtu.com/i/6V7h3n" target="_blank" rel="noopener"><img src="https://s3.ax1x.com/2021/03/04/6V7h3n.png" alt="6V7h3n.png"></a></p>
<h3 id="collection"><a href="#collection" class="headerlink" title="collection"></a>collection</h3><p>mongodb是通过一个个collection来做数据存储的，可以类比关系型数据库的表。</p>
<h3 id="shard-key-分片键"><a href="#shard-key-分片键" class="headerlink" title="shard_key (分片键)"></a>shard_key (分片键)</h3><p>mongodb是通过分片键来对collection进行分区的，也就是通过分片键来决定一个document如何分布式存入collection中。分片键是每个存放在collection中的document都持续拥有的不可缺少的一个字段或多个字段的组合。 分片键有下面几个要求：</p>
<ul>
<li>每个document都必须拥有，不可缺少。</li>
<li>已经分片的数据，分片键不可更改。</li>
<li>分片键必须加上索引。</li>
<li>分片键的选择对分片的性能、效率和可扩展性都有着重要影响。分片键和索引也会影响集群的分片策略。</li>
</ul>
<p><strong>分片键索引</strong></p>
<p>分片键必须有索引，索引可以是分片键上的索引，当分片键是索引前缀时，也可以是复合索引。 注意：分片键索引必须是横向(正向)，比如用id做索引时定义为key{id:1} 参考：<a href="https://docs.mongodb.com/manual/core/sharding-shard-key/#sharding-shard-key-indexes" target="_blank" rel="noopener">https://docs.mongodb.com/manual/core/sharding-shard-key/#sharding-shard-key-indexes</a></p>
<p>shard key在sharding搭建完毕后是不能修改的，一个collection上只能有一个shard key。<br>shard key上必须有索引（可以是以shard key开头的联合索引），如果没有mongodb会为shard key创建索引。如果是已经存在的collection那么必须手动为shard key创建索引。</p>
<p>MongoDB creates a unique index on the _id field during the creation of a collection. The _id index prevents clients from inserting two documents with the same value for the _id field. You cannot drop this index on the _id field.</p>
<p>mongodb offical doc <a href="https://docs.mongodb.com/manual/indexes/" target="_blank" rel="noopener">https://docs.mongodb.com/manual/indexes/</a></p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Tools/">Tools</a></li></ul>

    </footer>
  </div>

    
 
    
</article>

    
    <article
  id="post-Openshift-E04-Image-Stream是个啥"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/01/31/Openshift-E04-Image-Stream是个啥/"
    >Openshift E04 Image Stream是个啥</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2021/01/31/Openshift-E04-Image-Stream是个啥/" class="article-date">
  <time datetime="2021-01-31T05:23:35.000Z" itemprop="datePublished">2021-01-31</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/CICD/">CICD</a>
  </div>
 
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <p>Image Stream(中文名  镜像流) 是一组镜像的集合, OpenShift默认情况下提供了几个Image Streams，包括许多流行的runtime和frameworks。</p>
<p>Image Streams tag(中文名 镜像流标签对象)是指向Image Streams中的image的别名。通常缩写为istag。它包含一个image历史记录，表示为tag曾经指向的所有images的堆栈。</p>
<p>(??? image stream就是类似repo的概念)</p>
<p>一个镜像流标签对象（ImageStreamTag）指向一个镜像，可以是本地镜像或者远程镜像。如下的名为“python”的镜像流包含两个标签，标签34指向Python v3.4镜像，标签35指向Pythonv3.5镜像。</p>
<p>导入Image Stream<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Method 1</span></span><br><span class="line">oc create -f xxx.yaml -n openshift</span><br><span class="line"></span><br><span class="line"><span class="comment"># Method 2</span></span><br><span class="line">oc import-image</span><br></pre></td></tr></table></figure></p>
<p>查看Image Stream<br><code>oc get is -n openshift</code></p>
<p>查看Image Stream Tag</p>
<p><code>oc get istag</code></p>
<p>例子</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker pull ericnie2017/s2i-tomcat:latest</span><br><span class="line"></span><br><span class="line">oc import-image ericnie2017/s2i-tomcat -n openshift --confirm --insecure</span><br><span class="line"></span><br><span class="line">oc get is -n openshift | grep tomcat</span><br></pre></td></tr></table></figure>
<p>Service Catalog 中看到的不能与 <code>oc get is</code>  的结果一一对应，只能部分对应。</p>
<p> <a href="https://www.zhihu.com/column/p/31637802" target="_blank" rel="noopener">知乎-Service Catalog及OpenShift的历史</a></p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/OpenShift/">OpenShift</a></li></ul>

    </footer>
  </div>

    
 
    
</article>

    
    <article
  id="post-Openshift-E03-谈谈S2I"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/01/31/Openshift-E03-谈谈S2I/"
    >Openshift E03 谈谈S2I</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2021/01/31/Openshift-E03-谈谈S2I/" class="article-date">
  <time datetime="2021-01-31T04:27:01.000Z" itemprop="datePublished">2021-01-31</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/CICD/">CICD</a>
  </div>
 
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <p>  关于OpenShift，至今为止还没有梳理核心组件和概念上的解释，但似乎并不太妨碍初步的简单使用。而 Source to Image(S2I) 是OpenShift 的一个重要功能，也是其的一大特色。</p>
<h3 id="What"><a href="#What" class="headerlink" title="What"></a>What</h3><h5 id="第一：从OpenShift的角度来看"><a href="#第一：从OpenShift的角度来看" class="headerlink" title="第一：从OpenShift的角度来看"></a>第一：从OpenShift的角度来看</h5><p>  Source to Image(S2I) 是OopenShift中应用容器化的 <strong>标准流程</strong>。</p>
<h5 id="第二：-从自身工具的属性来看"><a href="#第二：-从自身工具的属性来看" class="headerlink" title="第二： 从自身工具的属性来看"></a>第二： 从自身工具的属性来看</h5><p>  Source-to-Image (S2I) 是一种用于构建可重复生成的 Docker 格式容器镜像的工具。</p>
<h3 id="How"><a href="#How" class="headerlink" title="How"></a>How</h3><p>S2I 需要的最基本的输入只有两个： 一个是源代码仓库(Source Code)；另一个是Builder Image（也称“构建镜像、Builder镜像”、基础镜像、构建器）</p>
<p>从应用的源代码构建并部署，Openshift通过一个S2I的构建过程编译打包并实现发布，具体可以参考<a href="https://www.cnblogs.com/ericnie/p/9677719.html" target="_blank" rel="noopener">这篇文章</a></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># install s2i tool on MacOS</span></span><br><span class="line">brew install <span class="built_in">source</span>-to-image</span><br><span class="line"></span><br><span class="line"><span class="comment"># s2i create &lt;image name&gt; &lt;destination directory&gt;</span></span><br><span class="line">s2i create s2i-tomcat s2i-tomcat</span><br><span class="line"></span><br><span class="line"><span class="comment"># get dir ,file </span></span><br><span class="line">➜  s2i-tomcat tree</span><br><span class="line">.</span><br><span class="line">├── Dockerfile</span><br><span class="line">├── Makefile</span><br><span class="line">├── README.md</span><br><span class="line">├── s2i</span><br><span class="line">│   └── bin</span><br><span class="line">│       ├── assemble</span><br><span class="line">│       ├── run</span><br><span class="line">│       ├── save-artifacts</span><br><span class="line">│       └── usage</span><br><span class="line">└── <span class="built_in">test</span></span><br><span class="line">    ├── run</span><br><span class="line">    └── <span class="built_in">test</span>-app</span><br><span class="line">        └── index.html</span><br><span class="line"></span><br><span class="line">4 directories, 9 files</span><br></pre></td></tr></table></figure>
<p><a href="https://www.cnblogs.com/ericnie/p/9677719.html" target="_blank" rel="noopener">S2I tomcat 镜像定制案例</a>，源码可见 <a href="https://github.com/cicd-draft/s2i-tomcat" target="_blank" rel="noopener">https://github.com/cicd-draft/s2i-tomcat</a></p>
<h3 id="OpenShift的构建"><a href="#OpenShift的构建" class="headerlink" title="OpenShift的构建"></a>OpenShift的构建</h3><p>OpenShift支持4种构建方式：Docker构建、S2I构建、Pipeline构建和自定义构建。详情可见<a href="https://access.redhat.com/documentation/zh-cn/openshift_container_platform/4.2/html-single/builds/index#builds-about_understanding-image-builds" target="_blank" rel="noopener">官方说明</a></p>
<ul>
<li><p>Docker构建会调用docker build命令，基于所提供的Dockerfile文件和所提供的内容来构建Docker镜像。</p>
</li>
<li><p>S2I构建是OpenShift的原创，它根据指定的构建镜像（Builder Image）和源代码（Source Code），构建生成可部署Docker镜像，并推送到OpenShift内部集成镜像库中。</p>
</li>
<li><p>Pipeline构建方式允许开发者定义Jenkins Pipeline。在项目首次使用该构建方式时，OpenShift容器云平台会启动一个Jenkins服务，然后再将该Pipeline交由它来执行，并负责启动、监控和管理该构建。BuildConfig对象中可以直接包含Jenkins Pipeline的内容，或者包含其Git仓库地址。</p>
</li>
</ul>
<hr>
<ul>
<li><a href="https://github.com/openshift/source-to-image/blob/master/docs/cli.md" target="_blank" rel="noopener">s2i cli usage</a></li>
<li><a href="https://www.cnblogs.com/ericnie/p/9677719.html" target="_blank" rel="noopener">S2I tomcat 镜像定制</a></li>
<li><a href="https://www.ewhisper.cn/binary-builds-with-openshift.html" target="_blank" rel="noopener">使用OpenShift进行二进制构建</a></li>
</ul>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/OpenShift/">OpenShift</a></li></ul>

    </footer>
  </div>

    
 
    
</article>

    
    <article
  id="post-Openshift-E02-部署Jenkins服务"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/01/10/Openshift-E02-部署Jenkins服务/"
    >Openshift E02 部署Jenkins服务</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2021/01/10/Openshift-E02-部署Jenkins服务/" class="article-date">
  <time datetime="2021-01-10T08:02:03.000Z" itemprop="datePublished">2021-01-10</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/CICD/">CICD</a>
  </div>
 
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <p>OpenShift 项目默认提供了两个Jenkins部署模板, Jenkins-ephemeral 和 Jenkins-persistent</p>
<ul>
<li><p><strong>Jenkins-ephemeral</strong> 模板部署的Jenkins服务的数据在容器退出后将丢失，适合测试使用；</p>
</li>
<li><p><strong>Jenkins-persistent</strong> 模板部署需要持久化卷的支持，其部署的Jenkins 服务的数据可以被持久化。</p>
</li>
</ul>
<blockquote>
<p> 这里有很多官方的案例源码： <a href="https://github.com/openshift/origin/tree/v1.3.0/examples" target="_blank" rel="noopener">https://github.com/openshift/origin/tree/v1.3.0/examples</a></p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">oc login -u developer https://192.168.99.109:8443</span><br><span class="line"></span><br><span class="line"><span class="comment"># create a new project, name: ci</span></span><br><span class="line">oc new-project ci</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create a template, </span></span><br><span class="line">oc create -f https://raw.githubusercontent.com/openshift/origin/v1.3.0/examples/jenkins/jenkins-ephemeral-template.json </span><br><span class="line"></span><br><span class="line"><span class="comment"># Get template</span></span><br><span class="line">oc get template</span><br><span class="line">NAME                DESCRIPTION                                       PARAMETERS        OBJECTS</span><br><span class="line">jenkins-ephemeral   Jenkins service, without persistent storage....   6 (1 generated)   6</span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">➜  ~ oc policy add-role-to-user edit -z default</span><br><span class="line">role <span class="string">"edit"</span> added: <span class="string">"default"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">➜  ~ oc new-app --template=jenkins-ephemeral --param=JENKINS_PASSWORD=welcome123</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">--&gt; Deploying template &quot;ci/jenkins-ephemeral&quot; to project ci</span><br><span class="line"></span><br><span class="line">     jenkins-ephemeral</span><br><span class="line">     ---------</span><br><span class="line">     Jenkins service, without persistent storage.</span><br><span class="line">     WARNING: Any data stored will be lost upon pod destruction. Only use this template for testing</span><br><span class="line"></span><br><span class="line">     A Jenkins service has been created in your project.  The username/password are admin/welcome.  The tutorial at https://github.com/openshift/origin/blob/master/examples/jenkins/README.md contains more information about using this template.</span><br><span class="line"></span><br><span class="line">     * With parameters:</span><br><span class="line">        * Jenkins Service Name=jenkins</span><br><span class="line">        * Jenkins JNLP Service Name=jenkins-jnlp</span><br><span class="line">        * Jenkins Password=welcome</span><br><span class="line">        * Memory Limit=512Mi</span><br><span class="line">        * Jenkins ImageStream Namespace=openshift</span><br><span class="line">        * Jenkins ImageStreamTag=jenkins:latest</span><br><span class="line"></span><br><span class="line">--&gt; Creating resources ...</span><br><span class="line">    route.route.openshift.io &quot;jenkins&quot; created</span><br><span class="line">    deploymentconfig.apps.openshift.io &quot;jenkins&quot; created</span><br><span class="line">    serviceaccount &quot;jenkins&quot; created</span><br><span class="line">    rolebinding.authorization.openshift.io &quot;jenkins_edit&quot; created</span><br><span class="line">    service &quot;jenkins-jnlp&quot; created</span><br><span class="line">    service &quot;jenkins&quot; created</span><br><span class="line">--&gt; Success</span><br><span class="line">    Access your application via route &apos;jenkins-ci.192.168.99.109.nip.io&apos;</span><br><span class="line">    Run &apos;oc status&apos; to view your app.</span><br></pre></td></tr></table></figure>
<p>部署失败了，💔</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">oc delete all -l app=jenkins-ephemeral</span><br><span class="line">pod <span class="string">"jenkins-1-6k7s6"</span> deleted</span><br><span class="line">replicationcontroller <span class="string">"jenkins-1"</span> deleted</span><br><span class="line">service <span class="string">"jenkins"</span> deleted</span><br><span class="line">service <span class="string">"jenkins-jnlp"</span> deleted</span><br><span class="line">deploymentconfig.apps.openshift.io <span class="string">"jenkins"</span> deleted</span><br><span class="line">route.route.openshift.io <span class="string">"jenkins"</span> deleted</span><br></pre></td></tr></table></figure>
<p>不能删除 serviceaccounts<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">oc delete serviceaccounts -l app=jenkins-ephemeral</span><br><span class="line">oc delete rolebindings.authorization.openshift.io jenkins_edit</span><br></pre></td></tr></table></figure></p>
<p>删除干净后，可以用命令 <code>oc get all -o wide</code> 验证</p>
<p>再来一次 </p>
<p><code>oc new-app --template=jenkins-ephemeral --param=JENKINS_PASSWORD=welcome123</code></p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/OpenShift/">OpenShift</a></li></ul>

    </footer>
  </div>

    
 
    
</article>

    
  </article>
  

  
  <nav class="page-nav">
    
    <a class="extend prev" rel="prev" href="/">上一页</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/13/">13</a><a class="extend next" rel="next" href="/page/3/">下一页</a>
  </nav>
  
</section>
</div>

      <footer class="footer">
  <div class="outer">
    <ul>
      <li>
        Copyrights &copy;
        2019-2024
        <i class="ri-heart-fill heart_icon"></i> John Doe
      </li>
    </ul>
    <ul>
      <li>
        
        
        
        Powered by <a href="https://hexo.io" target="_blank">Hexo</a>
        <span class="division">|</span>
        Theme - <a href="https://github.com/Shen-Yu/hexo-theme-ayer" target="_blank">Ayer</a>
        
      </li>
    </ul>
    <ul>
      <li>
        
        
        <span>
  <span><i class="ri-user-3-fill"></i>Visitors:<span id="busuanzi_value_site_uv"></span></span>
  <span class="division">|</span>
  <span><i class="ri-eye-fill"></i>Views:<span id="busuanzi_value_page_pv"></span></span>
</span>
        
      </li>
    </ul>
    <ul>
      
    </ul>
    <ul>
      
    </ul>
    <ul>
      <li>
        <!-- cnzz统计 -->
        
        <script type="text/javascript" src='https://s9.cnzz.com/z_stat.php?id=1278069914&amp;web_id=1278069914'></script>
        
      </li>
    </ul>
  </div>
</footer>
      <div class="float_btns">
        <div class="totop" id="totop">
  <i class="ri-arrow-up-line"></i>
</div>

<div class="todark" id="todark">
  <i class="ri-moon-line"></i>
</div>

      </div>
    </main>
    <aside class="sidebar on">
      <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <div class="logo">
    <a href="/"><img src="/images/palm-tree.svg" alt="Hexo"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/">主页</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/archives">归档</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories">分类</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/tags">标签</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/2020/03/16/about">关于我</a>
    </li>
    
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      
      <a class="nav-item-link nav-item-search"  title="Search">
        <i class="ri-search-line"></i>
      </a>
      
      
      <a class="nav-item-link" target="_blank" href="/atom.xml" title="RSS Feed">
        <i class="ri-rss-line"></i>
      </a>
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
    </aside>
    <div id="mask"></div>

<!-- #reward -->
<div id="reward">
  <span class="close"><i class="ri-close-line"></i></span>
  <p class="reward-p"><i class="ri-cup-line"></i>请我喝杯咖啡吧~</p>
  <div class="reward-box">
    
    
  </div>
</div>
    <script src="/js/jquery-2.0.3.min.js"></script> <script src="/js/lazyload.min.js"></script>
<!-- Tocbot -->

<script src="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.js"></script>
<link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.css"
/>
<script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js"></script>
<script src="/dist/main.js"></script>
<!-- ImageViewer -->
 <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css">
<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"></script>

<script>
    function viewer_init() {
        let pswpElement = document.querySelectorAll('.pswp')[0];
        let $imgArr = document.querySelectorAll(('.article-entry img:not(.reward-img)'))

        $imgArr.forEach(($em, i) => {
            $em.onclick = () => {
                // slider展开状态
                // todo: 这样不好，后面改成状态
                if (document.querySelector('.left-col.show')) return
                let items = []
                $imgArr.forEach(($em2, i2) => {
                    let img = $em2.getAttribute('data-idx', i2)
                    let src = $em2.getAttribute('data-target') || $em2.getAttribute('src')
                    let title = $em2.getAttribute('alt')
                    // 获得原图尺寸
                    const image = new Image()
                    image.src = src
                    items.push({
                        src: src,
                        w: image.width || $em2.width,
                        h: image.height || $em2.height,
                        title: title
                    })
                })
                var gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, {
                    index: parseInt(i)
                });
                gallery.init()
            }
        })
    }
    viewer_init()
</script> 
<!-- MathJax -->

<!-- Katex -->

<!-- busuanzi  -->
 <script src="/js/busuanzi-2.3.pure.min.js"></script> 
<!-- ClickLove -->

<!-- ClickBoom1 -->

<!-- ClickBoom2 -->

<!-- CodeCopy -->
 <link rel="stylesheet" href="/css/clipboard.css"> <script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
<script>
  function wait(callback, seconds) {
    var timelag = null;
    timelag = window.setTimeout(callback, seconds);
  }
  !function (e, t, a) {
    var initCopyCode = function(){
      var copyHtml = '';
      copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
      copyHtml += '<i class="ri-file-copy-2-line"></i><span>COPY</span>';
      copyHtml += '</button>';
      $(".highlight .code pre").before(copyHtml);
      $(".article pre code").before(copyHtml);
      var clipboard = new ClipboardJS('.btn-copy', {
        target: function(trigger) {
          return trigger.nextElementSibling;
        }
      });
      clipboard.on('success', function(e) {
        let $btn = $(e.trigger);
        $btn.addClass('copied');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-checkbox-circle-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPIED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-checkbox-circle-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
      clipboard.on('error', function(e) {
        e.clearSelection();
        let $btn = $(e.trigger);
        $btn.addClass('copy-failed');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-time-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPY FAILED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-time-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
    }
    initCopyCode();
  }(window, document);
</script>
 
<!-- CanvasBackground -->

<script>
  if (window.mermaid) {
    mermaid.initialize({ theme: "forest" });
  }
</script>


    
  </div>
</body>

</html>